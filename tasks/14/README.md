## Занятие 14. Резервное копирование
### Содержание
1. [Описание занятия](#description)  
2. [Домашнее задание](#homework)  
3. [Справочная информация](#info)  
4. [Выполнение](#exec)  
   - [Основное задание](#main)  
   - [Дополнительное задание](#add)


## 1. Описание занятия <a name="description"></a>
### Цели
- Обсуждаем политики и методики резервного копирования.  
- Разбираем некоторые особенности утилит `rsync`, `dd`, `tar`.  
- Практика работы с `BorgBackup`.   

## 2. Домашнее задание  <a name="homework"></a>
### Постановка задачи
Настроить стенд `Vagrant` с двумя виртуальными машинами: server и client.

Настроить политику бэкапа директории `/etc` с клиента:
1) Полный бэкап - раз в день
2) Инкрементальный - каждые 10 минут
3) Дифференциальный - каждые 30 минут

Запустить систему на два часа. Для сдачи ДЗ приложить `list jobs`, `list files jobid=<id>` и сами конфиги bacula-*.

### Дополнительно
Настроить доп. опции - сжатие, шифрование, дедупликация   

## 3. Справочная информация <a name="info"></a>  

<details>
   <summary></summary>
   
[Bacula](https://www.bacula.org/)  
[Официальная документация](https://www.bacula.org/documentation/documentation/)  

`Bacula` состоит из нескольких программных компонентов и основывается на модели «сервер-клиент». Компоненты сервера Bacula не обязательно запускать на одном сервере.  

Сервер `Bacula` (также сервер бэкапа) включает в себя следующие компоненты:
- `Bacula Director` (DIR): программное обеспечение, которое управляет операциями резервного копирования и восстановления, выполняемыми демонами File и Storage.  
- `Storage Daemon` (SD): программное обеспечение, которое выполняет операции чтения и записи на устройствах хранения, используемых для резервного копирования.  
- `Catalog` (каталог): сервисы, которые поддерживают базу данных резервных копий файлов. Данные хранятся в БД SQL, например, в `MySQL` или `PostgreSQL`.  
- `Bacula Console`: интерфейс командной строки, который позволяет администратору резервного копирования взаимодействовать с Bacula Director и управлять им.  

Клиент `Bacula` (сервер, данные которого будут копироваться) запускает `File Daemon` (FD). Это программное обеспечение, которое предоставляет серверу `Bacula` (в частности, Bacula Director) доступ к данным, которые нужно скопировать. Такие серверы называются клиентами бэкапа, или просто клиентами.

| Компонент          | Конфигурационный файл  |Компьютер
|:-------------------|:-----------------------|:-------
| Управления         | `bacula-dir.conf`      | Сервер, запускающий демон управления
| Хранения           | `bacula-sd.conf`       | Любой сервер, содержащий демон хранения
| Управления файлами | `bacula-fd.conf`       | Любой клиент, для которого нужно создавать резервные архивы
| Консоль управления | `bconsole.conf`        | Любой компьютер, который можно использовать для управления


- `Задания` — это базовые компоненты, характеризующие процесс работы утилиты, т. е. то, что представляет активность системы в виде выполняемых ею процессов. Задания построены на основе других компонентов: наборы файлов, клиенты, пулы памяти, а также схемы задания.  
- `Наборы файлов` — это, собственно, перечни как самих файлов, так и файловых систем. Они могут быть как включены в задания, так и исключены из них.  
- `Сообщения` — информация, включающая в себя данные о состоянии `Bacula`, которой демоны обмениваются между собой. Сообщения могут сохраняться в файлах журнала, а также отправляться по e-mail.  
- `Пулы` — это наборы физических устройств хранения.  

Проверка конфигурации:  
- `bacula-dir -tc /etc/bacula/bacula-dir.conf`   
- `bacula-sd -tc /etc/bacula/bacula-sd.conf`  
- `bacula-fd -tc /etc/bacula/bacula-fd.conf`  

</details>

## 4. Выполнение <a name="exec"></a>  

Лабораторный стенд, состоящий из двух объединенных в одну сеть машин, разворачивается из [Vagrantfile](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/tasks/14/Vagrantfile) с последующим минимальным провижинингом из сценария [provision.sh](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/tasks/14/provision.sh), суть которого заключается в настройке беспарольного `SSH`-доступа с машины `server` на машину `client1`.  Дальнейшая настройка на этих машинах сервера и клиента системы `Bacula` проводится средствами `Ansible`, для чего необходимо выполнить следующую команду:
```bash
cd ansible-bacula/ && ansible-playbook playbooks/install_bacula.yml
```

### Основное задание <a name="main"></a>  

### Дополнительное задание <a name="add"></a>  



