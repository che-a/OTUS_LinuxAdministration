## Занятие 3. Файловые системы и LVM

### Содержание
1. [Описание занятия](#description)  
2. [Домашнее задание](#homework)  
3. [Выполнение](#exec)  
    - [Уменьшение размера тома](#reduce)  

## 1. Описание занятия <a name="description"></a>
### Цели
- LVM - облегчаем себе жизнь управления файловыми системами;  
- архитектура файловой системы Linux: суперблок, блоки, inodes, журналы;  
- разбираемся в многообразии файловых систем.

### Краткое содержание  
- LVM;  
- основные понятия;  
- управление и конфигурирование;  
- практические примеры;  
- LVM Snapshots;  
- LVM Thin Provision;  
- LVM Cache;  
- LVM MIrror;  
- Файловые системы;  
- Блок, суперблок, айноды;  
- настройки ядра;  
- Журналирование;  
- Иерархия.

### Результаты  
Студент понимает как устроена файловая система. Может управлять LVM томами и знает как правильно разбить диск под файловую структуру и выбрать фс для системы.  

## 2. Домашнее задание  <a name="homework"></a>
### Постановка задачи  
Работа с LVM на имеющемся образе `/dev/mapper/VolGroup00-LogVol00 38G 738M 37G 2% /`
- уменьшить том под `/` до 8G;  
- выделить том под `/home`;  
- выделить том под `/var`;  
- `/var` - сделать в mirror;  
- `/home` - сделать том для снэпшотов;  
- прописать монтирование в `/etc/fstab`;  
- попробовать с разными опциями и разными файловыми системами (на выбор);  
- сгенерировать файлы в `/home/`;  
- снять снэпшот;  
- удалить часть файлов;  
- восстановится со снэпшота;  
- залоггировать работу можно с помощью утилиты `script`.

### Дополнительные задания  
На нашей куче дисков попробовать поставить btrfs/zfs - с кешем, снэпшотами - разметить здесь каталог `/opt`.

### Критерии оценки  
Критерии оценки: основная часть обязательна, задание со звездочкой +1 балл.

## 3. Выполнение <a name="exec"></a>  

Суть выполненного мною задания состоит в развертывании из [Vagrantfile](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/lesson_03/Vagrantfile) тестового окружения с установленной на LVM системой CentOS 7 и последующим ручным запуском в произвольном порядке двух сценариев: [lvm.sh](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/lesson_03/lvm.sh) и [zfs.sh](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/lesson_03/zfs.sh), первый из которых соотвествует базовому заданию и посвящен работе с LVM, а второй -- дополнительному заданию по работе с ZFS.
```bash
sudo -s
./lvm.sh
./zfs.sh
```

### Уменьшение размера тома <a name="reduce"></a>  
Необходимо уменьшить размер тома с корневой файловой системой до 8 ГБ.  
Обычно процесс уменьшения размера тома выполняется в несколько шагов:  
- размонтирование файловой системы тома,  
- проверка файловой системы тома на наличие ошибок,  
- уменьшение размера файловой системы тома,  
- уменьшение размера тома.  

В связи с тем, что:  
- необходимо уменьшать раздел с корневой файловой системой, которую нельзя размонтировать,  
- типом корневой файловой системы является XFS, размер которой нельзя уменьшить,  
алгоритм действий будет отличаться от вышеописанного:  

