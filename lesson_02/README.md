## Занятие 2. Дисковая подсистема

### Содержание
1. [Описание занятия](#description)  
2. [Домашнее задание](#homework)  
3. [Выполнение](#exec)
   - [Сборка системы с подключенным RAID-массивом](#exec1)  
   - [Сброс существующих RAID-устройств](#reset)
   - [Перенос работающей системы с одним диском на RAID 1](#exec2)  

## 1. Описание занятия <a name="description"></a>
#### Цели
- перечислить виды RAID массивов и их отличия,  
- получить информацию о дисковой подсистеме на любом сервере с ОС Linux,  
- собрать программный рейд и восстановить его после сбоя  

#### Краткое содержание  
- Задачи дисковой системы.  
- Программный и аппаратный RAID.  
- RAID 0/1/5/6/10/60.  
- Получение информации о дисковой системе системе с помощью `dmidecode`, `dmesg`, `smartctl`.  
- MBR и GPT. Команды `gdisk`, `fdisk`, `parted`, `partprobe`.

#### Результаты  
- Студент может собрать различные типы RAID

## 2. Домашнее задание  <a name="homework"></a>
#### Постановка задачи  
Системный администратор обязан уметь работать с дисковой подсистемой, делать это без ошибок, не допускать потерю данных. В этом задании необходимо продемонстрировать умение работать с software raid и инструментами для работы с работы с разделами(`parted`, `fdisk`, `lsblk`).
- работа с `mdadm`;  
- добавить в `Vagrantfile` еще дисков;  
- собрать R0/R5/R10 - на выбор;  
- сломать/починить raid;  
- создать на рейде GPT раздел и 5 партиций.
В качестве проверки принимаются - измененный `Vagrantfile`, скрипт для создания рейда  
#### Дополнительные задания  
- Vagrantfile, который сразу собирает систему с подключенным рейдом.  
- Перенесите работающую систему с одним диском на RAID 1. Даунтайм на загрузку с нового диска предполагается. В качестве проверки принимается вывод команды `lsblk` до и после и описание хода решения (можно воспользовать утилитой `script`).  
#### Критерии оценки  
- &laquo;4&raquo; - сдан `Vagrantfile` и скрипт для сборки, который можно запустить на поднятом образе;  
- &laquo;5&raquo; - сделаны доп. задания.

## 3. Выполнение <a name="exec"></a>  
Развертывание тестового окружения происходит из [Vagrantfile](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/lesson_02/Vagrantfile) с последующим провижинингом из сценария [script.sh](https://github.com/che-a/OTUS_LinuxAdministrator/blob/master/lesson_02/script.sh), который запускает обновление системы, установку необходимых пакетов, а также:  
- создает RAID 0 и RAID 1 на разделах дисках `/dev/sdb` и `/dev/sdc`;  
- последовательно создает и удаляет RAID 5, RAID 6 и RAID 10 на дисках `/dev/sdd`, `/dev/sde`, `/dev/sdf` и `/dev/sdg`.  

#### Сборка системы с подключенным RAID-массивом <a name="exec1"></a>
```console
$ sudo -s
# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0   40G  0 disk
└─sda1   8:1    0   40G  0 part /
sdb      8:16   0    6G  0 disk
sdc      8:32   0    6G  0 disk
sdd      8:48   0  250M  0 disk
sde      8:64   0  250M  0 disk
sdf      8:80   0  250M  0 disk
sdg      8:96   0  250M  0 disk
```

```console
# lshw -short | grep disk
/0/100/1.1/0.0.0    /dev/sda   disk        42GB VBOX HARDDISK
/0/100/d/0          /dev/sdb   disk        6442MB VBOX HARDDISK
/0/100/d/1          /dev/sdc   disk        6442MB VBOX HARDDISK
/0/100/d/2          /dev/sdd   disk        262MB VBOX HARDDISK
/0/100/d/3          /dev/sde   disk        262MB VBOX HARDDISK
/0/100/d/4          /dev/sdf   disk        262MB VBOX HARDDISK
/0/100/d/5          /dev/sdg   disk        262MB VBOX HARDDISK
```


#### Сброс существующих RAID-устройств  <a name="reset"></a>  

#### Перенос работающей системы с одним диском на RAID 1 <a name="exec2"></a>
